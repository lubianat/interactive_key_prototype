<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chave Interativa</title>
    <style>
        /* CSS stays as in previous version */
    </style>
</head>

<body>
    <!-- HTML structure remains unchanged -->

    <script id="specs" type="application/json">
    {
      "title": "Chave Interativa de Famílias Botânicas do Brasil",
      "version": "1.3",
      "author": "Gerado pelo ChatGPT"
    }
  </script>

    <script id="database" type="application/json">
    [
      { "name": "Rubiaceae", "wikidata": "Q156569", "traits": { "Leaf": { "Arrangement": "Opposite", "Type": "Simple" }, "Flower": { "Symmetry": "Actinomorphic", "Ovary position": "Inferior" } } },
      { "name": "Melastomataceae", "wikidata": "Q648380", "traits": { "Leaf": { "Arrangement": "Opposite", "Type": "Simple", "Venation": "Acrodromous" }, "Flower": { "Symmetry": "Actinomorphic", "Stamen number": "Numerous" } } },
      { "name": "Fabaceae", "wikidata": "Q44448", "traits": { "Leaf": { "Arrangement": "Alternate", "Type": "Compound" }, "Flower": { "Symmetry": "Zygomorphic", "Ovary position": "Superior" } } },
      { "name": "Myrtaceae", "wikidata": "Q156563", "traits": { "Leaf": { "Arrangement": "Opposite", "Type": "Simple", "Aroma": "Aromatic glands" }, "Flower": { "Symmetry": "Actinomorphic", "Stamen number": "Many" } } },
      { "name": "Poaceae", "wikidata": "Q43238", "traits": { "Leaf": { "Arrangement": "Alternate", "Type": "Simple", "Sheath": "Open" }, "Stem": { "Structure": "Hollow", "Nodes": "Prominent" }, "Flower": { "Inflorescence": "Spikelet" } } }
    ]
  </script>

    <script>
        async function getWikidataImageURL(qid, width = 640) {
            if (!qid) return null;
            const url = `https://www.wikidata.org/wiki/Special:EntityData/${qid}.json`;
            const resp = await fetch(url);
            if (!resp.ok) return null;
            const json = await resp.json();
            const entity = json.entities?.[qid];
            const p18 = entity?.claims?.P18?.[0]?.mainsnak?.datavalue?.value;
            if (!p18) return null;
            const filename = encodeURIComponent(p18);
            return `https://commons.wikimedia.org/wiki/Special:FilePath/${filename}?width=${width}`;
        }

        async function hydrateImagesFromWikidata(items) {
            await Promise.all(items.map(async (it) => {
                const url = await getWikidataImageURL(it.wikidata);
                if (url) it.image = url;
            }));
        }

        const specs = JSON.parse(document.getElementById("specs").textContent);
        const data = JSON.parse(document.getElementById("database").textContent);

        // Call hydration before initializing UI
        (async () => {
            await hydrateImagesFromWikidata(data);
            initApp();
        })();

        function initApp() {
            // Rest of the original JS logic here, unchanged, using `data` with populated .image fields
        }
    </script>
</body>

</html>